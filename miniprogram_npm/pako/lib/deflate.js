"use strict";const zlib_deflate=require("./zlib/deflate"),utils=require("./utils/common"),strings=require("./utils/strings"),msg=require("./zlib/messages"),ZStream=require("./zlib/zstream"),toString=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH,Z_SYNC_FLUSH:Z_SYNC_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH,Z_FINISH:Z_FINISH,Z_OK:Z_OK,Z_STREAM_END:Z_STREAM_END,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED}=require("./zlib/constants");function Deflate(t){this.options=utils.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;let i=zlib_deflate.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==Z_OK)throw new Error(msg[i]);if(e.header&&zlib_deflate.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?strings.string2buf(e.dictionary):"[object ArrayBuffer]"===toString.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=zlib_deflate.deflateSetDictionary(this.strm,t),i!==Z_OK)throw new Error(msg[i]);this._dict_set=!0}}function deflate(t,e){const i=new Deflate(e);if(i.push(t,!0),i.err)throw i.msg||msg[i.err];return i.result}function deflateRaw(t,e){return(e=e||{}).raw=!0,deflate(t,e)}function gzip(t,e){return(e=e||{}).gzip=!0,deflate(t,e)}Deflate.prototype.push=function(t,e){const i=this.strm,s=this.options.chunkSize;let r,n;if(this.ended)return!1;for(n=e===~~e?e:!0===e?Z_FINISH:Z_NO_FLUSH,"string"==typeof t?i.input=strings.string2buf(t):"[object ArrayBuffer]"===toString.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(n===Z_SYNC_FLUSH||n===Z_FULL_FLUSH)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=zlib_deflate.deflate(i,n),r===Z_STREAM_END)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=zlib_deflate.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK;if(0!==i.avail_out){if(n>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},Deflate.prototype.onData=function(t){this.chunks.push(t)},Deflate.prototype.onEnd=function(t){t===Z_OK&&(this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},module.exports.Deflate=Deflate,module.exports.deflate=deflate,module.exports.deflateRaw=deflateRaw,module.exports.gzip=gzip,module.exports.constants=require("./zlib/constants");
//# sourceMappingURL=deflate.js.map