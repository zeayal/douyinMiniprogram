"use strict";const zlib_inflate=require("./zlib/inflate"),utils=require("./utils/common"),strings=require("./utils/strings"),msg=require("./zlib/messages"),ZStream=require("./zlib/zstream"),GZheader=require("./zlib/gzheader"),toString=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH,Z_FINISH:Z_FINISH,Z_OK:Z_OK,Z_STREAM_END:Z_STREAM_END,Z_NEED_DICT:Z_NEED_DICT,Z_STREAM_ERROR:Z_STREAM_ERROR,Z_DATA_ERROR:Z_DATA_ERROR,Z_MEM_ERROR:Z_MEM_ERROR}=require("./zlib/constants");function Inflate(t){this.options=utils.assign({chunkSize:65536,windowBits:15,to:""},t||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||t&&t.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&0==(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;let n=zlib_inflate.inflateInit2(this.strm,i.windowBits);if(n!==Z_OK)throw new Error(msg[n]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),i.dictionary&&("string"==typeof i.dictionary?i.dictionary=strings.string2buf(i.dictionary):"[object ArrayBuffer]"===toString.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(n=zlib_inflate.inflateSetDictionary(this.strm,i.dictionary),n!==Z_OK)))throw new Error(msg[n])}function inflate(t,i){const n=new Inflate(i);if(n.push(t),n.err)throw n.msg||msg[n.err];return n.result}function inflateRaw(t,i){return(i=i||{}).raw=!0,inflate(t,i)}Inflate.prototype.push=function(t,i){const n=this.strm,e=this.options.chunkSize,s=this.options.dictionary;let r,o,a;if(this.ended)return!1;for(o=i===~~i?i:!0===i?Z_FINISH:Z_NO_FLUSH,"[object ArrayBuffer]"===toString.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(e),n.next_out=0,n.avail_out=e),r=zlib_inflate.inflate(n,o),r===Z_NEED_DICT&&s&&(r=zlib_inflate.inflateSetDictionary(n,s),r===Z_OK?r=zlib_inflate.inflate(n,o):r===Z_DATA_ERROR&&(r=Z_NEED_DICT));n.avail_in>0&&r===Z_STREAM_END&&n.state.wrap>0&&0!==t[n.next_in];)zlib_inflate.inflateReset(n),r=zlib_inflate.inflate(n,o);switch(r){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(r),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||r===Z_STREAM_END))if("string"===this.options.to){let t=strings.utf8border(n.output,n.next_out),i=n.next_out-t,s=strings.buf2string(n.output,t);n.next_out=i,n.avail_out=e-i,i&&n.output.set(n.output.subarray(t,t+i),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(r!==Z_OK||0!==a){if(r===Z_STREAM_END)return r=zlib_inflate.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Inflate.prototype.onData=function(t){this.chunks.push(t)},Inflate.prototype.onEnd=function(t){t===Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},module.exports.Inflate=Inflate,module.exports.inflate=inflate,module.exports.inflateRaw=inflateRaw,module.exports.ungzip=inflate,module.exports.constants=require("./zlib/constants");
//# sourceMappingURL=inflate.js.map