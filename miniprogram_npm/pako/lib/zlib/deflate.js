"use strict";const{_tr_init:_tr_init,_tr_stored_block:_tr_stored_block,_tr_flush_block:_tr_flush_block,_tr_tally:_tr_tally,_tr_align:_tr_align}=require("./trees"),adler32=require("./adler32"),crc32=require("./crc32"),msg=require("./messages"),{Z_NO_FLUSH:Z_NO_FLUSH,Z_PARTIAL_FLUSH:Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH,Z_FINISH:Z_FINISH,Z_BLOCK:Z_BLOCK,Z_OK:Z_OK,Z_STREAM_END:Z_STREAM_END,Z_STREAM_ERROR:Z_STREAM_ERROR,Z_DATA_ERROR:Z_DATA_ERROR,Z_BUF_ERROR:Z_BUF_ERROR,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION,Z_FILTERED:Z_FILTERED,Z_HUFFMAN_ONLY:Z_HUFFMAN_ONLY,Z_RLE:Z_RLE,Z_FIXED:Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY,Z_UNKNOWN:Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED}=require("./constants"),MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=286,D_CODES=30,BL_CODES=19,HEAP_SIZE=573,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=262,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(t,e)=>(t.msg=msg[e],e),rank=t=>2*t-(t>4?9:0),zero=t=>{let e=t.length;for(;--e>=0;)t[e]=0},slide_hash=t=>{let e,a,s,_=t.w_size;e=t.hash_size,s=e;do{a=t.head[--s],t.head[s]=a>=_?a-_:0}while(--e);e=_,s=e;do{a=t.prev[--s],t.prev[s]=a>=_?a-_:0}while(--e)};let HASH_ZLIB=(t,e,a)=>(e<<t.hash_shift^a)&t.hash_mask,HASH=HASH_ZLIB;const flush_pending=t=>{const e=t.state;let a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},flush_block_only=(t,e)=>{_tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,flush_pending(t.strm)},put_byte=(t,e)=>{t.pending_buf[t.pending++]=e},putShortMSB=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},read_buf=(t,e,a,s)=>{let _=t.avail_in;return _>s&&(_=s),0===_?0:(t.avail_in-=_,e.set(t.input.subarray(t.next_in,t.next_in+_),a),1===t.state.wrap?t.adler=adler32(t.adler,e,_,a):2===t.state.wrap&&(t.adler=crc32(t.adler,e,_,a)),t.next_in+=_,t.total_in+=_,_)},longest_match=(t,e)=>{let a,s,_=t.max_chain_length,r=t.strstart,n=t.prev_length,i=t.nice_match;const l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,h=t.window,d=t.w_mask,o=t.prev,u=t.strstart+258;let f=h[r+n-1],g=h[r+n];t.prev_length>=t.good_match&&(_>>=2),i>t.lookahead&&(i=t.lookahead);do{if(a=e,h[a+n]===g&&h[a+n-1]===f&&h[a]===h[r]&&h[++a]===h[r+1]){r+=2,a++;do{}while(h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&r<u);if(s=258-(u-r),r=u-258,s>n){if(t.match_start=e,n=s,s>=i)break;f=h[r+n-1],g=h[r+n]}}}while((e=o[e&d])>l&&0!=--_);return n<=t.lookahead?n:t.lookahead},fill_window=t=>{const e=t.w_size;let a,s,_;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-262)&&(t.window.set(t.window.subarray(e,e+e-s),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),slide_hash(t),s+=e),0===t.strm.avail_in)break;if(a=read_buf(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=a,t.lookahead+t.insert>=3)for(_=t.strstart-t.insert,t.ins_h=t.window[_],t.ins_h=HASH(t,t.ins_h,t.window[_+1]);t.insert&&(t.ins_h=HASH(t,t.ins_h,t.window[_+3-1]),t.prev[_&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=_,_++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)},deflate_stored=(t,e)=>{let a,s,_,r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n=0,i=t.strm.avail_in;do{if(a=65535,_=t.bi_valid+42>>3,t.strm.avail_out<_)break;if(_=t.strm.avail_out-_,s=t.strstart-t.block_start,a>s+t.strm.avail_in&&(a=s+t.strm.avail_in),a>_&&(a=_),a<r&&(0===a&&e!==Z_FINISH||e===Z_NO_FLUSH||a!==s+t.strm.avail_in))break;n=e===Z_FINISH&&a===s+t.strm.avail_in?1:0,_tr_stored_block(t,0,0,n),t.pending_buf[t.pending-4]=a,t.pending_buf[t.pending-3]=a>>8,t.pending_buf[t.pending-2]=~a,t.pending_buf[t.pending-1]=~a>>8,flush_pending(t.strm),s&&(s>a&&(s=a),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+s),t.strm.next_out),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s,t.block_start+=s,a-=s),a&&(read_buf(t.strm,t.strm.output,t.strm.next_out,a),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a)}while(0===n);return i-=t.strm.avail_in,i&&(i>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=i&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-i,t.strm.next_in),t.strstart),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),n?4:e!==Z_NO_FLUSH&&e!==Z_FINISH&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(_=t.window_size-t.strstart,t.strm.avail_in>_&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,_+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),_>t.strm.avail_in&&(_=t.strm.avail_in),_&&(read_buf(t.strm,t.window,t.strstart,_),t.strstart+=_,t.insert+=_>t.w_size-t.insert?t.w_size-t.insert:_),t.high_water<t.strstart&&(t.high_water=t.strstart),_=t.bi_valid+42>>3,_=t.pending_buf_size-_>65535?65535:t.pending_buf_size-_,r=_>t.w_size?t.w_size:_,s=t.strstart-t.block_start,(s>=r||(s||e===Z_FINISH)&&e!==Z_NO_FLUSH&&0===t.strm.avail_in&&s<=_)&&(a=s>_?_:s,n=e===Z_FINISH&&0===t.strm.avail_in&&a===s?1:0,_tr_stored_block(t,t.block_start,a,n),t.block_start+=a,flush_pending(t.strm)),n?3:1)},deflate_fast=(t,e)=>{let a,s;for(;;){if(t.lookahead<262){if(fill_window(t),t.lookahead<262&&e===Z_NO_FLUSH)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-262&&(t.match_length=longest_match(t,a)),t.match_length>=3)if(s=_tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+1]);else s=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2},deflate_slow=(t,e)=>{let a,s,_;for(;;){if(t.lookahead<262){if(fill_window(t),t.lookahead<262&&e===Z_NO_FLUSH)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-262&&(t.match_length=longest_match(t,a),t.match_length<=5&&(t.strategy===Z_FILTERED||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){_=t.strstart+t.lookahead-3,s=_tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=_&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(s=_tr_tally(t,0,t.window[t.strstart-1]),s&&flush_block_only(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=_tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2},deflate_rle=(t,e)=>{let a,s,_,r;const n=t.window;for(;;){if(t.lookahead<=258){if(fill_window(t),t.lookahead<=258&&e===Z_NO_FLUSH)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(_=t.strstart-1,s=n[_],s===n[++_]&&s===n[++_]&&s===n[++_])){r=t.strstart+258;do{}while(s===n[++_]&&s===n[++_]&&s===n[++_]&&s===n[++_]&&s===n[++_]&&s===n[++_]&&s===n[++_]&&s===n[++_]&&_<r);t.match_length=258-(r-_),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=_tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2},deflate_huff=(t,e)=>{let a;for(;;){if(0===t.lookahead&&(fill_window(t),0===t.lookahead)){if(e===Z_NO_FLUSH)return 1;break}if(t.match_length=0,a=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2};function Config(t,e,a,s,_){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=s,this.func=_}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=t=>{t.window_size=2*t.w_size,zero(t.head),t.max_lazy_match=configuration_table[t.level].max_lazy,t.good_match=configuration_table[t.level].good_length,t.nice_match=configuration_table[t.level].nice_length,t.max_chain_length=configuration_table[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||42!==e.status&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&113!==e.status&&666!==e.status?1:0},deflateResetKeep=t=>{if(deflateStateCheck(t))return err(t,Z_STREAM_ERROR);t.total_in=t.total_out=0,t.data_type=Z_UNKNOWN;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?42:113,t.adler=2===e.wrap?0:1,e.last_flush=-2,_tr_init(e),Z_OK},deflateReset=t=>{const e=deflateResetKeep(t);return e===Z_OK&&lm_init(t.state),e},deflateSetHeader=(t,e)=>deflateStateCheck(t)||2!==t.state.wrap?Z_STREAM_ERROR:(t.state.gzhead=e,Z_OK),deflateInit2=(t,e,a,s,_,r)=>{if(!t)return Z_STREAM_ERROR;let n=1;if(e===Z_DEFAULT_COMPRESSION&&(e=6),s<0?(n=0,s=-s):s>15&&(n=2,s-=16),_<1||_>9||a!==Z_DEFLATED||s<8||s>15||e<0||e>9||r<0||r>Z_FIXED||8===s&&1!==n)return err(t,Z_STREAM_ERROR);8===s&&(s=9);const i=new DeflateState;return t.state=i,i.strm=t,i.status=42,i.wrap=n,i.gzhead=null,i.w_bits=s,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=_+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<_+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.sym_buf=i.lit_bufsize,i.sym_end=3*(i.lit_bufsize-1),i.level=e,i.strategy=r,i.method=a,deflateReset(t)},deflateInit=(t,e)=>deflateInit2(t,e,Z_DEFLATED,15,8,Z_DEFAULT_STRATEGY),deflate=(t,e)=>{if(deflateStateCheck(t)||e>Z_BLOCK||e<0)return t?err(t,Z_STREAM_ERROR):Z_STREAM_ERROR;const a=t.state;if(!t.output||0!==t.avail_in&&!t.input||666===a.status&&e!==Z_FINISH)return err(t,0===t.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);const s=a.last_flush;if(a.last_flush=e,0!==a.pending){if(flush_pending(t),0===t.avail_out)return a.last_flush=-1,Z_OK}else if(0===t.avail_in&&rank(e)<=rank(s)&&e!==Z_FINISH)return err(t,Z_BUF_ERROR);if(666===a.status&&0!==t.avail_in)return err(t,Z_BUF_ERROR);if(42===a.status&&0===a.wrap&&(a.status=113),42===a.status){let e=Z_DEFLATED+(a.w_bits-8<<4)<<8,s=-1;if(s=a.strategy>=Z_HUFFMAN_ONLY||a.level<2?0:a.level<6?1:6===a.level?2:3,e|=s<<6,0!==a.strstart&&(e|=32),e+=31-e%31,putShortMSB(a,e),0!==a.strstart&&(putShortMSB(a,t.adler>>>16),putShortMSB(a,65535&t.adler)),t.adler=1,a.status=113,flush_pending(t),0!==a.pending)return a.last_flush=-1,Z_OK}if(57===a.status)if(t.adler=0,put_byte(a,31),put_byte(a,139),put_byte(a,8),a.gzhead)put_byte(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),put_byte(a,255&a.gzhead.time),put_byte(a,a.gzhead.time>>8&255),put_byte(a,a.gzhead.time>>16&255),put_byte(a,a.gzhead.time>>24&255),put_byte(a,9===a.level?2:a.strategy>=Z_HUFFMAN_ONLY||a.level<2?4:0),put_byte(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(put_byte(a,255&a.gzhead.extra.length),put_byte(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=crc32(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,0),put_byte(a,9===a.level?2:a.strategy>=Z_HUFFMAN_ONLY||a.level<2?4:0),put_byte(a,3),a.status=113,flush_pending(t),0!==a.pending)return a.last_flush=-1,Z_OK;if(69===a.status){if(a.gzhead.extra){let e=a.pending,s=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+s>a.pending_buf_size;){let _=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+_),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>e&&(t.adler=crc32(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex+=_,flush_pending(t),0!==a.pending)return a.last_flush=-1,Z_OK;e=0,s-=_}let _=new Uint8Array(a.gzhead.extra);a.pending_buf.set(_.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending+=s,a.gzhead.hcrc&&a.pending>e&&(t.adler=crc32(t.adler,a.pending_buf,a.pending-e,e)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let e,s=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>s&&(t.adler=crc32(t.adler,a.pending_buf,a.pending-s,s)),flush_pending(t),0!==a.pending)return a.last_flush=-1,Z_OK;s=0}e=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,put_byte(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>s&&(t.adler=crc32(t.adler,a.pending_buf,a.pending-s,s)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let e,s=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>s&&(t.adler=crc32(t.adler,a.pending_buf,a.pending-s,s)),flush_pending(t),0!==a.pending)return a.last_flush=-1,Z_OK;s=0}e=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,put_byte(a,e)}while(0!==e);a.gzhead.hcrc&&a.pending>s&&(t.adler=crc32(t.adler,a.pending_buf,a.pending-s,s))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(flush_pending(t),0!==a.pending))return a.last_flush=-1,Z_OK;put_byte(a,255&t.adler),put_byte(a,t.adler>>8&255),t.adler=0}if(a.status=113,flush_pending(t),0!==a.pending)return a.last_flush=-1,Z_OK}if(0!==t.avail_in||0!==a.lookahead||e!==Z_NO_FLUSH&&666!==a.status){let s=0===a.level?deflate_stored(a,e):a.strategy===Z_HUFFMAN_ONLY?deflate_huff(a,e):a.strategy===Z_RLE?deflate_rle(a,e):configuration_table[a.level].func(a,e);if(3!==s&&4!==s||(a.status=666),1===s||3===s)return 0===t.avail_out&&(a.last_flush=-1),Z_OK;if(2===s&&(e===Z_PARTIAL_FLUSH?_tr_align(a):e!==Z_BLOCK&&(_tr_stored_block(a,0,0,!1),e===Z_FULL_FLUSH&&(zero(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),flush_pending(t),0===t.avail_out))return a.last_flush=-1,Z_OK}return e!==Z_FINISH?Z_OK:a.wrap<=0?Z_STREAM_END:(2===a.wrap?(put_byte(a,255&t.adler),put_byte(a,t.adler>>8&255),put_byte(a,t.adler>>16&255),put_byte(a,t.adler>>24&255),put_byte(a,255&t.total_in),put_byte(a,t.total_in>>8&255),put_byte(a,t.total_in>>16&255),put_byte(a,t.total_in>>24&255)):(putShortMSB(a,t.adler>>>16),putShortMSB(a,65535&t.adler)),flush_pending(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Z_OK:Z_STREAM_END)},deflateEnd=t=>{if(deflateStateCheck(t))return Z_STREAM_ERROR;const e=t.state.status;return t.state=null,113===e?err(t,Z_DATA_ERROR):Z_OK},deflateSetDictionary=(t,e)=>{let a=e.length;if(deflateStateCheck(t))return Z_STREAM_ERROR;const s=t.state,_=s.wrap;if(2===_||1===_&&42!==s.status||s.lookahead)return Z_STREAM_ERROR;if(1===_&&(t.adler=adler32(t.adler,e,a,0)),s.wrap=0,a>=s.w_size){0===_&&(zero(s.head),s.strstart=0,s.block_start=0,s.insert=0);let t=new Uint8Array(s.w_size);t.set(e.subarray(a-s.w_size,a),0),e=t,a=s.w_size}const r=t.avail_in,n=t.next_in,i=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,fill_window(s);s.lookahead>=3;){let t=s.strstart,e=s.lookahead-2;do{s.ins_h=HASH(s,s.ins_h,s.window[t+3-1]),s.prev[t&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=t,t++}while(--e);s.strstart=t,s.lookahead=2,fill_window(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=n,t.input=i,t.avail_in=r,s.wrap=_,Z_OK};module.exports.deflateInit=deflateInit,module.exports.deflateInit2=deflateInit2,module.exports.deflateReset=deflateReset,module.exports.deflateResetKeep=deflateResetKeep,module.exports.deflateSetHeader=deflateSetHeader,module.exports.deflate=deflate,module.exports.deflateEnd=deflateEnd,module.exports.deflateSetDictionary=deflateSetDictionary,module.exports.deflateInfo="pako deflate (from Nodeca project)";
//# sourceMappingURL=deflate.js.map