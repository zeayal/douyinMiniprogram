# 颜色选择器更新说明

## 更新内容

为了避开特定的颜色及其相近色，我们对颜色选择器进行了以下更新：

### 需要避开的颜色
- `#006400` - 深绿色（零星、一星、二星标记色）
- `#FF8C00` - 琥珀色（三星标记色）
- `#DC143C` - 深红色（四星标记色）
- `#9932CC` - 紫色（五星标记色）

### 更新后的优化颜色方案

#### 快速颜色选择（12种优化颜色）
经过多重过滤和HSL色彩空间分析，确保颜色间有足够差异：

**蓝色系**（与绿色、红色、紫色都有明显差异）：
- `#1E90FF` - 道奇蓝（主色调）
- `#00BFFF` - 深天蓝
- `#87CEEB` - 天蓝色
- `#4682B4` - 钢蓝色

**青色系**：
- `#20B2AA` - 浅海洋绿
- `#48D1CC` - 中绿松石
- `#7FFFD4` - 绿松石
- `#00CED1` - 暗绿松石

**粉色系**：
- `#FF69B4` - 热粉红
- `#FFB6C1` - 浅粉红
- `#FFC0CB` - 粉红色
- `#FF1493` - 深粉红

#### 颜色分类（重新组织）
- **暖色系**：粉色、橙色等温暖色调
- **冷色系**：蓝色、青色等清凉色调
- **明亮色**：黄色、紫色等明亮色调
- **中性色**：绿色等自然色调

### 技术实现

#### 1. 颜色相似度检测（更严格）
- 使用欧几里得距离算法计算RGB空间相似度
- 阈值从30%降低到25%，更严格地过滤相近颜色
- 自动识别与需要避开颜色相近的颜色

#### 2. HSL色彩空间分析（新增）
- **色相差异**：至少30度，确保颜色在色轮上有足够距离
- **饱和度差异**：至少15%，确保颜色鲜艳程度不同
- **亮度差异**：至少20%，确保颜色明暗程度不同
- 使用`areColorsDistinctInHSL()`函数进行智能检测

#### 3. 多重过滤机制（优化）
- **第一层**：基础安全颜色筛选
- **第二层**：避开需要避开的颜色（阈值20%）
- **第三层**：HSL空间差异检测
- **第四层**：备用颜色补充（阈值15%）

#### 4. 智能颜色建议
- `shouldAvoidColor()` - 检查颜色是否应该避开
- `areColorsTooSimilar()` - 检查两个颜色是否过于相似
- `areColorsDistinctInHSL()` - 在HSL空间中检查颜色差异
- `getOptimizedSafeColors()` - 获取经过多重优化的安全颜色

### 使用方法

1. **快速选择**：点击快速颜色网格中的颜色即可选择
2. **分类选择**：切换到不同颜色分类查看更多选择
3. **自定义颜色**：使用颜色选择器自定义颜色（会自动避开需要避开的颜色）
4. **颜色预览**：实时预览选中的颜色效果

### 优化效果

#### 视觉差异
- 所有颜色与地图标记色有足够差异
- 颜色之间也有足够的视觉区分
- 在地图背景上有良好的可读性

#### 用户体验
- 减少颜色选择的困惑
- 提供更专业的颜色搭配
- 自动避开问题颜色

#### 技术优势
- 多重验证确保颜色质量
- 智能算法自动筛选
- 可配置的相似度阈值

### 注意事项

- 所有提供的颜色都经过严格筛选，确保与需要避开的颜色有足够差异
- 如果用户手动输入颜色，系统会进行多重检测
- 建议使用预设的优化颜色，避免与地图标记色产生混淆
- 颜色选择器会自动记录用户的选择历史

### 更新文件

- `miniprogram/pages/addRoute/addRoute.ts` - 使用优化颜色函数
- `miniprogram/components/color-picker/color-picker.ts` - 更新颜色方案
- `miniprogram/utils/util.ts` - 新增HSL分析和多重过滤函数
- `miniprogram/pages/addRoute/颜色选择器更新说明.md` - 详细说明文档
- `miniprogram/pages/addRoute/颜色优化测试.md` - 优化测试说明

### 测试建议

1. **视觉测试**：在地图背景上测试每个颜色
2. **对比测试**：与地图标记色进行对比
3. **差异测试**：验证颜色间的可区分性
4. **功能测试**：测试颜色选择器的各项功能
