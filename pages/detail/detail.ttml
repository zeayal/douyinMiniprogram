<!--pages/detail/detail.ttml-->
<view class="container">
  <!-- isLoading -->
  <skeleton tt:if="{{isLoading}}"></skeleton>
  <block tt:else>
    <!-- è½®æ’­å›¾éƒ¨åˆ† -->
    <view class="slideshow-container">
      <view class="tip-wrapper" tt:if="{{tip}}">
        <view class="tip-container">
          <view class="tip-text" style="animation-duration: {{scrollDuration}}s">{{tip}}</view>
        </view>
      </view>
      <swiper class="slides" autoplay interval="5000">
        <block tt:if="{{detail.images.length > 0}}">
          <block tt:for="{{detail.images}}" tt:key="*this">
            <swiper-item>
              <image class="slide-image" mode="aspectFill" src="{{item}}" alt="{{detail.name}}çš„å®æ‹å›¾"></image>
            </swiper-item>
          </block>
        </block>
        <block tt:else>
          <swiper-item>
            <image class="slide-image" mode="aspectFit" src="https://icons.unistar.icu/icons/no_pictures_yet.jpg"></image>
          </swiper-item>
        </block>
      </swiper>
    </view>

    <!-- è¥åœ°ä¿¡æ¯ -->
    <view class="camp-info">
      <view class="tag-bar">
        <view class="filter-item star-{{detail.scoreNumber}}" tt:if="{{detail.scoreNumber >= 3}}">{{detail.scoreNumber}}æ˜Ÿ</view>
        <view class="filter-item" tt:if="{{!detail.isCharged}}" data-type="price-type">å…è´¹</view>
        <view class="filter-item charged" tt:if="{{detail.isCharged}}">æ”¶è´¹</view>
        <view class="filter-item" data-type="facility" tt:if="{{detail.hasToilet}}">å•æ‰€</view>
        <view class="filter-item" tt:if="{{detail.hasWater}}">æ¥æ°´</view>
        <view class="filter-item" tt:if="{{detail.hasElectricity}}">å……ç”µæ¡©</view>
        <view class="filter-item" tt:if="{{detail.canPitchTent}}">æ­å¸ç¯·</view>
      </view>
      <view class="camp-name" data-type="camp-name">{{detail.name}}</view>
      <view class="camp-stats">
        <text class="score">å¯¼èˆªæ¬¡æ•°ï¼š {{detail.navigationCount }}</text>
        <text class="views">æŸ¥çœ‹æ¬¡æ•°ï¼š {{detail.viewCount || '0'}}</text>
      </view>
      <view class="button-group">
        <view class="nav-button" bind:tap="nav">
          <text>å¯¼èˆªå‰å¾€</text>
          <block tt:if="{{directDistance}}">
            <image class="spot-distance-image" src="https://icons.unistar.icu/icons/arrow_right.png" mode="aspectFill" />
            <text class="spot-distance-text">ç›´çº¿è·ç¦»{{(directDistance.formatted)}}</text>
          </block>
        </view>
        <view class="action-button-group">
          <view class="action-button" bind:tap="handleCollect" style="background-color: {{isCollected ? '#ffa500' : '#909399'}}">
            <text>{{isCollected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
          </view>
          <button open-type="share" class="action-button share-button">
            <text>åˆ†äº«</text>
          </button>
          <view class="action-button checkin-button" bind:tap="showCheckinModal">
            <text>æ‰“å¡è¯„åˆ†</text>
          </view>
          <view class="action-button modify-button" bind:tap="handleModify">
            <text>ä¿®æ”¹</text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¥åœ°è¯¦æƒ… -->
    <view class="camp-detail">
      <view class="section-title">è¥åœ°ä»‹ç»</view>
      <view class="intro">
        <view style="white-space: pre-line;">{{detail.description}}</view>
      </view>
    </view>


    <!-- æ‰“å¡è®°å½• -->
    <view class="camp-detail">
      <view class="section-title">æœ€æ–°æ‰“å¡</view>
      <view class="check-in-empty-list">
        <view>ğŸŒŸ <text class="highlight-1">ä½ çš„ä¸€å¥è¯</text>ï¼Œèƒ½å¸®å¤§å®¶<text class="highlight-1">å°‘èµ°ä¸å°‘å†¤æ‰è·¯ï¼</text></view>
        <view>ğŸ“
          <text class="highlight">è¥åœ°</text>è¿˜æœ‰æ•ˆå—ï¼Ÿ
          <text class="highlight">æ”¶è´¹</text>å˜äº†ï¼Ÿ
          <text class="highlight">è®¾æ–½</text>æœ‰è°ƒæ•´ï¼Ÿ
        </view>
        <view>
          ğŸ”Œ èƒ½ç”¨<text class="highlight-2">ç”µ</text>å—ï¼Ÿ
          ğŸš° æœ‰<text class="highlight-2">æ°´</text>å—ï¼Ÿ
          ğŸš½ <text class="highlight-2">å•æ‰€</text>å¯ç”¨æ—¶é—´ï¼Ÿ
        </view>
        <view>
          ğŸ“ <text class="record-check-in-text highlight-3" bind:tap="showCheckinModal">[æ‰“å¡è¯„åˆ†]</text>
          æˆ– <text class="record-check-in-text highlight-4" bind:tap="handleModify">[ä¿®æ”¹]</text> åˆ†äº«è¥åœ°æœ€æ–°æƒ…å†µï¼
        </view>
      </view>
      <view class="action-items">
        <view class="action-item" tt:for="{{checkInList}}" tt:key="id">
          <view class="action-header">
            <text class="action-user">{{item.nickName}}</text>
            <text class="action-time">{{item.checkInTime}}</text>
          </view>
          <view class="action-content">
            {{item.content}}
          </view>
        </view>
      </view>
    </view>

    <!-- è¥åœ°å›¾ç‰‡åˆ—è¡¨ -->
    <view class="camp-detail">
      <view class="section-title">è¥åœ°å®æ‹</view>
      <view class="photo-grid">
        <block tt:if="{{detail.images.length > 0}}">
          <view class="photo-item" tt:for="{{detail.images}}" tt:key="*this">
            <image mode="widthFix" src="{{item}}"></image>
          </view>
        </block>
        <block tt:else>
          <view class="photo-item">
            <image mode="widthFix" src="https://icons.unistar.icu/icons/no_pictures_yet.jpg"></image>
          </view>
        </block>
      </view>
    </view>

    <!-- æ‰“å¡å¼¹æ¡† -->
    <view class="modal" tt:if="{{showModal}}">
      <view class="modal-mask" bind:tap="hideCheckinModal"></view>
      <view class="modal-content">
        <view class="modal-header">
          <text class="modal-title">è¥åœ°æ‰“å¡è¯„åˆ†</text>
          <text class="modal-close" bind:tap="hideCheckinModal">Ã—</text>
        </view>
        <view class="modal-body">
          <!-- æ˜Ÿçº§è¯„åˆ† -->

          <view class="rating-section">
            <text class="rating-label">è¥åœ°è¯„åˆ†ï¼š</text>
            <view>
              <view class="star-rating">
                <view class="star-item {{selectedRating >= item ? 'active' : ''}}" tt:for="{{stars}}" tt:key="*this" bind:tap="selectRating" data-rating="{{item}}">
                  {{selectedRating >= item ? 'â˜…' : 'â˜†'}}
                </view>
              </view>
              <text class="rating-text">å½“å‰è¯„åˆ†: {{selectedRating > 0 ? selectedRating + 'æ˜Ÿ' : 'æœªé€‰æ‹©'}}</text>
            </view>
          </view>

          <textarea class="checkin-textarea" placeholder="åˆ†äº«ä½ çš„è¥åœ°ä½“éªŒ..." maxlength="200" bindinput="onInputChange" value="{{checkinContent}}"></textarea>
          <view class="text-count">{{checkinContent.length}}/200</view>
        </view>
        <view class="modal-footer">
          <button class="submit-button" bind:tap="submitCheckin">æäº¤</button>
        </view>
      </view>
    </view>

    <!-- è¥åœ°è¯¦ç»†ä¿¡æ¯ -->
    <view class="camp-details" aria-hidden="true">
      <view class="detail-item" data-key="name">è¥åœ°åç§°: {{detail.name}}</view>
      <view class="detail-item" data-key="type">è¥åœ°ç±»å‹: æˆ·å¤–éœ²è¥è¥åœ°</view>
      <view class="detail-item" data-key="facility">è¥åœ°è®¾æ–½: {{detail.hasToilet ? 'æœ‰å•æ‰€' : 'æ— å•æ‰€'}} {{detail.hasWater ? 'å¯æ¥æ°´' : 'ä¸å¯æ¥æ°´'}} {{detail.hasElectricity ? 'æœ‰å……ç”µæ¡©' : 'æ— å……ç”µæ¡©'}}</view>
      <view class="detail-item" data-key="location">è¥åœ°ä½ç½®: çº¬åº¦{{detail.latitude}} ç»åº¦{{detail.longitude}}</view>
      <view class="detail-item" data-key="feature">è¥åœ°ç‰¹è‰²: {{detail.description || 'é€‚åˆè‡ªé©¾ã€æˆ¿è½¦åœé '}}</view>
    </view>

  </block>





</view>